(function(){var z=function(e){return e?"string"==typeof e?[e]:Array.prototype.slice.call(e):[]},A=function(e,l){for(var a=0;a<e.length;a++)if(e[a]==l)return!0;return!1},B=function(e,l,a){for(var k=[],b=e.x,c=e.y,f=">",g=0,d,h;g<a.length;g++)if(d=a.charAt(g),h=a.substr(g),/^[><+\\-]$/.test(d)){f=d;">"==d?b+=e.cell.colSpan:"<"==d?b--:"+"==d?c--:"-"==d?c+=e.cell.rowSpan:"\\"==d&&(c+=e.cell.rowSpan,b+=e.cell.colSpan);if(0>c||c>=l.length||0>b||b>=l[c].length)return[];e=l[c][b];e.refCell&&(e=e.cell);b=
e.x;c=e.y}else if(d=/^\d+[:a-z]*/i.exec(h))if(h=parseInt(/^\d/.exec(h)[0],10),0===h&&0===g)k.push(e),g+=d[0].length-1;else for(var w=0;w<h;w++){if(0<w){d=f;">"==d?b+=e.cell.colSpan:"<"==d?b--:"+"==d?c--:"-"==d?c+=e.cell.rowSpan:"\\"==d&&(c+=e.cell.rowSpan,b+=e.cell.colSpan);if(0>c||c>=l.length||0>b||b>=l[c].length)return[];e=l[c][b];e.refCell&&(e=e.cell);b=e.x;c=e.y}k.push(e)}else if(/[.]{3}\s*$/.test(h))return k.concat(B(e,l,a));return k},C=function(e){for(var l={},a=[],k=[],b=0,c;b<e.length;b++)c=
e[b],l[1E9*c.y+c.x]=c.cell;for(b in l)l.hasOwnProperty(b)&&a.push({order:b,cell:l[b]});a.sort(function(a,b){return a.order-b.order});for(b=0;b<a.length;b++)k.push(a[b].cell);return k},n=function(e){var l={};this.element=e;this.isAChildCell=function(a){if(!n.isACell(a))return!1;for(;a=a.parentElement;){if(a==this.element)return!0;if(n.isACell(a))break}return!1};this.clearCache=function(){l={}};this.removeCol=function(a){a||0===a||"0"===a||(a=-1);for(var k=this.matrix(),b=0;b<k.length;b++){var c=k[b];
if(0>a){var f=c.length+a;0>f&&(f=0)}else f=a>=c.length?c.length-1:a;if(f=c[f])b+=(f.refCell||f).cell.rowSpan-1,f.refCell?--f.refCell.cell.colSpan:1<f.cell.colSpan?--f.cell.colSpan:f.cell.parentElement.removeChild(f.cell)}};this.removeRow=function(a){a||0===a||"0"===a||(a=-1);var k=this.element,b=this.matrix();0>a?(a=b.length+a,0>a&&(a=0)):a>=b.length&&(a=b.length-1);var c=b[a];b=b[a+1];for(var f=0;f<c.length;f++){var g=c[f];if(g.refCell)1<g.refCell.cell.rowSpan&&--g.refCell.cell.rowSpan;else if(1<
g.cell.rowSpan&&b){0!==g.cell.rowSpan&&--g.cell.rowSpan;for(var d=b[f],h=f;h<b.length;h++)b[h].cell&&(d=b[h].cell,h=b.length);k.rows[a+1].insertBefore(g.cell,d)}f+=(g.refCell||g).cell.colSpan-1}k.rows[a].parentElement.removeChild(k.rows[a])};this.insertCol=function(a,k){a||0===a||"0"===a||(a=-1);for(var b=this.element,c=this.matrix(),f=0;f<c.length;f++){var g=c[f];if(0>a){var d=g.length+a+1;0>d&&(d=0)}else d=a>g.length?g.length:a;g=0===d?c[f][d]:c[f][d-1];var h=c[f][d-1];if(h&&h.refCell)h.refCell.cell.colSpan+=
1,f+=h.refCell.cell.rowSpan-1;else{h=c[f][d];var e=f;g?(g=g.cell||g.refCell,d=document.createElement(g.tagName),d.rowSpan=g.rowSpan,f+=g.rowSpan-1):d=document.createElement("TD");k&&k.call(this,d);b.rows[e].insertBefore(d,h?h.cell:null)}}};this.insertRow=function(a,k){a||0===a||"0"===a||(a=-1);var b=this.element,c=document.createElement("tr"),f=this.matrix();0>a?(a=f.length+a+1,0>a&&(a=0)):a>f.length&&(a=f.length);if(f=0==a?f[a]:f[a-1])for(var g=0;g<f.length;g++){var d=f[g];if(d&&d.refCell)d.refCell.cell.rowSpan+=
1,g+=d.refCell.cell.colSpan-1;else{d=d.cell||d.refCell;var h=document.createElement(d.tagName);h.colSpan=d.colSpan;g+=d.colSpan-1;k&&k.call(this,h);c.appendChild(h)}}else h=document.createElement("td"),k&&k.call(this,h),c.appendChild(h);((b.rows[0]||{}).parentElement||b).insertBefore(c,b.rows[a])};this.split=function(a,k){a.tagName&&(a=[a]);a=Array.prototype.slice.call(a);for(var b=0;b<a.length;b++){var c=a[b];if(!(1>=c.rowSpan&&1>=c.colSpan)){var f=this.matrix(),g=this.position(c,f),d=Array(c.rowSpan);
for(b=0;b<c.rowSpan;b++){d[b]=document.createDocumentFragment();for(var h=0;h<c.colSpan;h++)if(0!==b||0!==h){var w=document.createElement(c.tagName);k&&k.call(this,w);d[b].appendChild(w)}}c.rowSpan=c.colSpan=1;for(b=0;b<d.length;b++){c=f[g.y+b];w=null;for(h=g.x+(0===b?1:0);h<c.length;h++)c[h].cell&&(w=c[h].cell,h=c.length);e.rows[g.y+b].insertBefore(d[b],w)}}}};this.mergeVertical=function(a,k){for(var b=!1,c=0;c<n.maxIteration;c++)if(this._mergeVertical(a,k))b=!0;else break;return b};this.mergeHorizontal=
function(a,k){for(var b=!1,c=0;c<n.maxIteration;c++)if(this._mergeHorizontal(a,k))b=!0;else break;return b};this.first=function(){for(var a=this.element.rows,k=0;k<a.length;k++)for(var b=a[k].cells;0<b.length;)return b[0];return null};this.last=function(){for(var a=this.element.rows,k=a.length-1;0<=k;k--)for(var b=a[k].cells,c=b.length-1;0<=c;)return b[c];return null};this.cells=function(a,k){if(1>arguments)return[];1==arguments?(k=a,a=this.first()):"[object Array]"===Object.prototype.toString.call(a)&&
(a=this.cell.apply(this,a));if(!this.isAChildCell(a))return[];var b=[];if(!this.isAChildCell(a))return b;b=k.split(/,+/g);for(var c=[],f=this.matrix(),g=this.position(a,f),d=0;d<b.length;d++)c=c.concat(B(f[g.y][g.x],f,b[d]));return C(c)};this.cell=function(a,k,b){b=b||this.matrix();0>k&&(k=b.length+k);if(0>k||k>=b.length)return null;k=b[k];0>a&&(a=k.length+a);if(0>a||a>=k.length)return null;a=k[a];return a.cell||a.refCell.cell};this.merge=function(a,k){for(var b,c,f=!1,g=0;g<n.maxIteration;g++)if(c=
this._mergeVertical(a,k),b=this._mergeHorizontal(a,k),c||b)f=!0;else if(!c&&!b)break;return f};this._mergeVertical=function(a,k){a=z(a);if(1>=a.length)return!1;for(var b=this.matrix(),c=!1,f=0,g=a.length;f<g;f++){var d=a[f],h=[],e=d.colSpan,p=d.rowSpan;if(this.isAChildCell(d)){var l=this.position(d,b);if(!l)continue;for(var m=l.y+d.rowSpan;m<b.length;m++)for(var n=[],v=0,r=b[m],y=0,t=l.x;t<r.length;t++){var q=r[t].cell;y+=(q||{}).colSpan||1;v=0===v?(q||{}).rowSpan:v;q&&A(a,q)&&y<=e&&q.rowSpan==v?
(n.push(q),e===y&&(h=h.concat(n),p+=v,t=r.length),t+=q.colSpan-1,m+=q.rowSpan-1):(t=r.length,m=b.length)}}if(0<h.length){k&&k.call(this,e,p,d,h);for(m=0;m<h.length;m++)h[m].parentElement.removeChild(h[m]);d.rowSpan=p;d.colSpan=e;c=!0}}return c};this._mergeHorizontal=function(a,k){a=z(a);if(1>=a.length)return!1;for(var b=this.matrix(),c=!1,f=0,g=a.length;f<g;f++){var d=a[f],h=[],e=d.rowSpan,p=d.colSpan;if(this.isAChildCell(d)){var l=this.position(d,b);if(!l)continue;for(var m=l.x+d.colSpan,n=b[l.y].length;m<
n;m++)for(var v=[],r=0,y=0,t=l.y;t<b.length;t++){var q=b[t][m].cell;y+=(q||{}).rowSpan||1;r=0===r?(q||{}).colSpan:r;q&&A(a,q)&&y<=e&&q.colSpan==r?(v.push(q),e===y&&(h=h.concat(v),p+=r,t=b.length),t+=q.rowSpan-1,m+=q.colSpan-1):(t=b.length,m=n)}}if(0<h.length){k&&k.call(this,p,e,d,h);for(m=0;m<h.length;m++)h[m].parentElement.removeChild(h[m]);d.rowSpan=e;d.colSpan=p;c=!0}}return c};this.position=function(a,k){k=k||this.matrix();for(var b=0,c;b<k.length;b++){c=k[b];for(var f=0,g;f<c.length;f++)if((g=
c[f])&&g.cell==a)return{x:g.x,y:g.y}}return null};this.matrix=function(a){var k=this.element,b=[],c=[],f=k.rows;k=k.innerHTML;if(n.cache&&l[k])return l[k];this.clearCache();for(var g=0;g<f.length;g++)b.push([]);for(g=0;g<f.length;g++)for(var d=f[g],h=0,e=0;e<d.cells.length;e++){var p=d.cells[e];if("object"!=typeof b[g][h]&&!1!==b[g][h]){var x=a?parseInt(p.getAttribute("rowSpan"),10):p.rowSpan;x=Math.floor(Math.abs(isNaN(x)?1:x));0===x&&!a&&p.ownerDocument&&"BackCompat"==p.ownerDocument.compatMode&&
(x=1);if(1==x)if(!p.colSpan||2>p.colSpan)b[g][h]={cell:p,x:h,y:g};else for(var m=b[g][h]={cell:p,x:h,y:g},u=1;u<p.colSpan;u++)b[g][h+u]={refCell:m,x:h+u,y:g};else{m=b[g][h]={cell:p,x:h,y:g};0===x&&c.push(m);u=0;for(var v=Math.max(x,1);u<v;u++)for(var r=0;r<p.colSpan;r++)if(0!==u||0!==r){var y=b[g+u][h+r]={refCell:m,x:h+r,y:g+u};0===x&&c.push(y)}}}else e--;h++}if(c.length)for(g=0;g<c.length;g++)for(a=c[g],f=a.x,e=a.y+1;e<b.length;e++)for(b[e].splice(f,0,{x:f,y:e,refCell:a.refCell||a}),d=f+1;d<b[e].length;d++)b[e][d].x+=
1;n.cache&&(l[k]=b);return b};this.getCellPosition=function(a){for(var e=[],b=this.element.rows,c=0;c<b.length;c++)e.push([]);for(c=0;c<b.length;c++)for(var f=b[c].cells,g=0,d=0;d<f.length;d++){var h=f[d];if(e[c][g])d--,g++;else{if(h==a)return{x:c,y:g};for(var l=1;l<h.rowSpan;l++)for(var p=0;p<h.colSpan;p++)e[c+l][g+p]=!0;g+=h.colSpan}}};this.getCellByPosition=function(a,e){var b=[],c=this.element.rows;if(a>=c.length)return null;for(var f=0;f<c.length;f++)b.push([]);f=0;for(var g=Math.min(c.length,
a+1);f<g;f++)for(var d=c[f].cells,h=0,k=0;k<d.length;k++){var l=d[k];if(b[f][h])k--,h++;else{if(f==a&&h==e)return l;for(var n=1;n<l.rowSpan;n++)for(var m=0;m<l.colSpan;m++)b[f+n][h+m]=!0;h+=l.colSpan}}}};n.isACell=function(e){return e&&("TD"==e.tagName||"TH"==e.tagName)};n.rowSpan=function(e){if(n.isACell(e)){if(0===e.rowSpan){if(-1==e.cellIndex)return 1;e=e.parentElement;var l=1;if(!e||"TR"!=e.tagName)return-1;for(;e=e.nextSibling;)"TR"==e.tagName&&l++;return l}return e.rowSpan}return null};n.maxIteration=
50;n.cache=!0;n.build=4;n.version="0.1.3";n.stable=!1;window.Table=n})();